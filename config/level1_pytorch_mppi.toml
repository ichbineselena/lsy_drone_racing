# Level 1 with PyTorch MPPI + MPC Hybrid Controller

[controller]
file = "attitude_mpc_1.py"
trajectory_builder = "pytorch_mppi"  # Enable PyTorch MPPI

[deploy]
check_race_track = true
check_drone_start_pos = true
real_track_objects = true

[[deploy.drones]]
id = 91
channel = 100
drone_model = "cf21B_500"

[sim]
physics = "first_principles"
drone_model = "cf21B_500"
camera_view = [5.0, 180.0, -25.0, 0.0, 0.0, 0.0]
freq = 500
attitude_freq = 500
render = true

[env]
id = "DroneRacing-v0"
seed = "random"
freq = 50
sensor_range = 0.7
control_mode = "attitude"

[env.track]
randomize = false

# Gates for Level 1
[[env.track.gates]]
pos = [0.5 , 0.25, 0.7]
rpy = [0.0, 0.0, -0.78]
[[env.track.gates]]
pos = [1.05, 0.75, 1.2]
rpy = [0.0, 0.0, 2.35]
[[env.track.gates]]
pos = [-1.0, -0.25, 0.7]
rpy = [0.0, 0.0, 3.14]
[[env.track.gates]]
pos = [0.0, -0.75, 1.2]
rpy = [0.0, 0.0, 0.0]

# Obstacles
[[env.track.obstacles]]
pos = [0.0, 0.75, 1.55]
[[env.track.obstacles]]
pos = [1.0, 0.25, 1.55]
[[env.track.obstacles]]
pos = [-1.5, -0.25, 1.55]
[[env.track.obstacles]]
pos = [-0.5, -0.75, 1.55]

# Starting position
[[env.track.drones]]
pos = [-1.5, 0.75, 0.01]
rpy = [0.0, 0.0, 0.0]
vel = [0, 0, 0]
ang_vel = [0, 0, 0]

[env.track.safety_limits]
pos_limit_low = [-2.5, -1.5, -1e-3]
pos_limit_high = [2.5, 1.5, 2.0]

# Disturbances and randomizations (Level 1 challenge)
[env.disturbances.action]
fn = "normal"
scale = 0.001

[env.disturbances.dynamics]
fn = "uniform"
[env.disturbances.dynamics.kwargs]
minval = [-0.1, -0.1, -0.1]
maxval = [0.1, 0.1, 0.1]

[env.randomizations.drone_pos]
fn = "uniform"
[env.randomizations.drone_pos.kwargs]
minval = [-0.1, -0.1, 0.0]
maxval = [0.1, 0.1, 0.02]

[env.randomizations.drone_rpy]
fn = "uniform"
[env.randomizations.drone_rpy.kwargs]
minval = [-0.1, -0.1, -0.1]
maxval = [0.1, 0.1, 0.1]

[env.randomizations.drone_mass]
fn = "uniform"
[env.randomizations.drone_mass.kwargs]
minval = -0.005
maxval = 0.005

[env.randomizations.drone_inertia]
fn = "uniform"
[env.randomizations.drone_inertia.kwargs]
minval = [-0.000001, -0.000001, -0.000001]
maxval = [0.000001, 0.000001, 0.000001]
